{% extends "app-base.html" %}
{% load staticfiles %}

{% block page_title %}
	Create New Page - {{ block.super }}
{% endblock page_title %}

{% block content %}
<h1>Create New Flatpage</h1>
<form class="form" action="" method="POST" encytype="multipart/form-data">
    {% csrf_token %}
    <div class="error" style="display:none;"></div>
	<div class="col-1">
		<fieldset>
			<legend class="visuallyhidden">Page Content</legend>
			
			<div class="editor input-container">
				<div class="label-error-container">
				    <label for="id_head_content ">Head Content</label>
				    {{ form.head_content.errors }}
				</div>
			    {{ form.head_content }}
			    <div id="editor_id_head_content"></div>
			</div>
			
			<div class="editor input-container">
				<div class="label-error-container">
				    <label for="id_main_content">Main Content</label>
				    {{ form.main_content.errors }}
				</div>
			    {{ form.main_content }}
			    <div id="editor_id_main_content"></div>
			</div>

			<div class="editor input-container">
				<div class="label-error-container">
				    <label for="id_css">CSS</label>
				    {{ form.css.errors }}
				</div>
			    {{ form.css }}
			    <div id="editor_id_css"></div>
			</div>

			<div class="editor input-container">
				<div class="label-error-container">
				    <label for="id_footer_content">Footer Content</label>
				    {{ form.footer_content.errors }}
				</div>
			    {{ form.footer_content }}
			    <div id="editor_id_footer_content"></div>
			</div>
		</fieldset>
	</div>

    <div class="col-2">
	    <fieldset>
	    	<div class="input-container">
		    	<legend>Templates</legend>
			    <label for="id_page_template">Page Template</label>
			    {{ form.page_template.errors }}
			    {{ form.page_template }}
	    	</div>
			<div class="input-container">
			    <label for="id_user_template">User Template</label>
			    {{ form.user_template.errors }}
			    {{ form.user_template }}
			</div>
	    </fieldset>
	    
	    <fieldset>
	    	<legend></legend>
		    <label for="id_title">Page Title</label>
		    {{ form.title.errors }}
		    {{ form.title }}
		
		    <label for="id_slug">URL</label>
		    {{ form.slug.errors }}
		    {{ form.slug }}
		
		    <label for="id_meta_description">Meta Description</label>
		    {{ form.meta_description.errors }}
		    {{ form.meta_description }}
	    </fieldset>
	    
	    <fieldset>
		    <label for="id_main_image">Main Image</label>
		    {{ form.main_image.errors }}
		    {{ form.main_image }}
	    </fieldset>
	    
	    <fieldset>
	    	<legend></legend>
	    	<label for="id_head_content">Sites</label>
		    {{ form.sites.errors }}
		    {{ form.sites }}
	    </fieldset>
	    <fieldset>
	    	<legend></legend>
	    	<label for="id_head_content">Comments</label>
		    {{ form.comments.errors }}
		    {{ form.comments }}
	    </fieldset>
	    <fieldset>
	    	<button type="submit">Save</button>
	    </fieldset>
    </div>
</form>
{% endblock content %}

{% block footer %}
    <script src="{% static 'js/ace/ace.js' %}" data-ace-base="{% static 'js/ace' %}" type="text/javascript" charset="utf-8"></script>

    <script type="text/javascript">
        var aceHeadContent = ace.edit("editor_id_head_content");
        var djangoHeadContent = document.getElementById("id_head_content");
        aceHeadContent.setTheme("ace/theme/monokai");
        aceHeadContent.getSession().setMode("ace/mode/html");
        aceHeadContent.getSession().setValue(djangoHeadContent.value);
        aceHeadContent.getSession().on('change', function(){
            djangoHeadContent.value = aceHeadContent.getSession().getValue();
        });
    </script>

    <script type="text/javascript">
        var aceMainContent = ace.edit("editor_id_main_content");
        var djangoMainContent = document.getElementById("id_main_content");
        aceMainContent.setTheme("ace/theme/monokai");
        aceMainContent.getSession().setMode("ace/mode/html");
        aceMainContent.getSession().setUseWrapMode(true);
        aceMainContent.getSession().setValue(djangoMainContent.value);
        aceMainContent.getSession().on('change', function(){
            djangoMainContent.value = aceMainContent.getSession().getValue();
        });
    </script>

    <script type="text/javascript">
        var aceCSS = ace.edit("editor_id_css");
        var djangoCSS = document.getElementById("id_css");
        aceCSS.setTheme("ace/theme/monokai");
        aceCSS.getSession().setMode("ace/mode/css");
        aceCSS.getSession().setValue(djangoCSS.value);
        aceCSS.getSession().on('change', function(){
            djangoCSS.value = aceCSS.getSession().getValue();
        });
    </script>

    <script type="text/javascript">
        var aceFooterContent = ace.edit("editor_id_footer_content");
        var djangoFooterContent = document.getElementById("id_footer_content");
        aceFooterContent.setTheme("ace/theme/monokai");
        aceFooterContent.getSession().setMode("ace/mode/html");
        aceFooterContent.getSession().setValue(djangoFooterContent.value);
        aceFooterContent.getSession().on('change', function(){
            djangoFooterContent.value = aceFooterContent.getSession().getValue();
        });
    </script>

    <!-- auto populate url slug -->
    <script src="{% static 'admin/js/urlify.js' %}" type="text/javascript"></script>
    <script type="text/javascript">
        document.getElementById("id_title").onkeyup = function() {
            var e = document.getElementById("id_slug");
            if (!e._changed) { e.value = URLify(document.getElementById("id_title").value, 50); }
        }
    </script>
{% endblock footer %}